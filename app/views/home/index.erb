Hello <%=@_current_facebook_user.name %> !

<p>The application shows how facebooker2 provides canvas+iframe integration with OAuth 2.0</p>

<p>We fetched your name on the server side by using Facebooker2 and Mogli.</p>

Now we will fetch some of your friends using the client-side Javascript API:

<div id="profile_pics">loading...</div>


If you click this link to reload the page you should still be authenticated on the server side even though there is no signed_request.
This is because we should now have a cookie with all of the relevant auth info
<br/>
<a href="/home">Clicky</a>

<p style="text-align:center;">
a Christopher G Johnson production
</p>
<p>
	The source code for this page is available at 
	<a href="https://github.com/clickonchris/facebooker2_canvas_example" target="_BLANK">https://github.com/clickonchris/facebooker2_canvas_example</a>
</p>
<a href="mailto:chris@clickonchris.com">chris@clickonchris.com</a><br/>
<a href="http://www.clickonchris.com" target="_BLANK">www.clickonchris.com</a> (Author's Blog)<br/><br/>
<a href="http://www.twitter.com/clickonchris" target="_BLANK"><img src="http://twitter-badges.s3.amazonaws.com/follow_me-b.png" alt="Follow clickonchris on Twitter"/></a><br/><br/>
<a href="http://www.linkedin.com/in/johnsonchristopherg" target="_BLANK"><img src="http://www.linkedin.com/img/webpromo/btn_viewmy_160x25.gif" border="0" alt="View Christopher Johnson's profile on LinkedIn" width="160" height="25" /></a>(Hire me!)

<script>
fbEnsureInit(function() {
	//alert('loading profile pics');
	var profilePicsDiv = document.getElementById('profile_pics');
	FB.getLoginStatus(function(response) {
	  if (!response.session) {
	    profilePicsDiv.innerHTML = '<em>You are not connected</em>';
	    return;
	  }
	
	  FB.api({ method: 'friends.get' }, function(result) {
	    var markup = '';
	    var numFriends = result ? Math.min(15, result.length) : 0;
	    if (numFriends > 0) {
	      for (var i=0; i<numFriends; i++) {
	        markup += (
	          '<fb:profile-pic size="square" ' +
	                          'uid="' + result[i] + '" ' +
	                          'facebook-logo="true"' +
	          '></fb:profile-pic>'
	        );
	      }
	    }
	    profilePicsDiv.innerHTML = markup;
	    FB.XFBML.parse(profilePicsDiv);
	  });
	});
});
</script>
